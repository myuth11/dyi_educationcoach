<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Education Coach - Get personalized guidance for your DYLvolunteering journey with Myu" />
  <meta name="author" content="Republic Polytechnic" />
  <title>Education Coach | DYL Volunteering Assistant</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <!-- Custom CSS -->
  <link rel="stylesheet" href="css/styles.css" />
  <style>
    .myu-chatbox {
      margin-top: 2rem;
      background: #f9fafb;
      padding: 1rem;
      border-radius: 1rem;
      border: 1px solid #e5e7eb;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    .myu-chat-messages {
      min-height: 120px;
      max-height: 300px;
      overflow-y: auto;
      padding: 0.5rem 0;
      margin-bottom: 1rem;
    }
    .myu-chat-messages div {
      margin-bottom: 1rem;
      font-size: 0.95rem;
    }
    .myu-chat-form {
      display: flex;
      gap: 0.5rem;
    }
    .myu-chat-form input {
      flex: 1;
      padding: 0.6rem 1rem;
      border-radius: 1rem;
      border: 1px solid #cbd5e1;
      font-size: 1rem;
    }
    .myu-chat-error {
      color: #dc2626;
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header" role="banner">
    <div class="container">
      <div class="header-content">
        <div class="logo-section"><i class="fas fa-graduation-cap"></i><h1>DYL Volunteering Assistant</h1></div>
        <div class="rp-branding"><span class="rp-text">Republic Polytechnic</span></div>
      </div>
      <nav class="nav" role="navigation" aria-label="Main navigation">
        <div class="nav-menu">
          <a href="index.html" class="nav-link"><i class="fas fa-home"></i><span>Home</span></a>
          <a href="elyiana.html" class="nav-link"><i class="fas fa-calendar-alt"></i><span>Activity Planner</span></a>
          <a href="myu.html" class="nav-link active"><i class="fas fa-graduation-cap"></i><span>Education Coach</span></a>
          <a href="alaster.html" class="nav-link"><i class="fas fa-project-diagram"></i><span>Project Hub</span></a>
          <a href="weiqiang.html" class="nav-link"><i class="fas fa-lightbulb"></i><span>Reflection & Portfolio Coach</span></a>
          <a href="edlyana.html" class="nav-link"><i class="fas fa-search"></i><span>Beneficiary Finder</span></a>
        </div>
        <div class="nav-actions">
          <button class="nav-btn btn btn-primary" aria-label="Start Coaching">
            <i class="fas fa-robot"></i><span>Start Coaching</span>
          </button>
          <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode">
            <i class="fas fa-moon"></i>
          </button>
        </div>
      </nav>
    </div>
  </header>

  <!-- Main -->
  <main class="main" role="main">
    <section class="page-header">
      <div class="container">
        <div class="page-header-content">
          <div class="page-icon"><i class="fas fa-user-graduate"></i></div>
          <h2>Education Coach</h2>
          <p class="page-subtitle">Your personal guide for educational growth and skill development through volunteering</p>
        </div>
      </div>
    </section>

    <section class="description-section">
      <div class="container">
        <div class="description-content">
          <h3>Meet Your Personal Education Coach üë©‚Äçüè´</h3>
          <p>Hello! I'm Myu, your dedicated Education Coach. I'm here to help you make the most of your DYLvolunteering experience through tailored learning plans.</p>
          <div class="features-grid">
            <div class="feature-card"><i class="fas fa-brain"></i><h4>Skill Development</h4><p>Identify and develop key skills through your volunteering experiences</p></div>
            <div class="feature-card"><i class="fas fa-graduation-cap"></i><h4>Learning Pathways</h4><p>Create personalized learning journeys that complement your studies</p></div>
            <div class="feature-card"><i class="fas fa-chart-line"></i><h4>Progress Tracking</h4><p>Monitor your educational growth and celebrate learning milestones</p></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Chatbot Section -->
    <section class="chatbot-section">
      <div class="container">
        <div class="chatbot-wrapper">
          <div class="chatbot-header">
            <h3>Start Your Educational Journey</h3>
            <p>Chat with Myu to explore learning opportunities and create your personalized education plan!</p>
          </div>
          <div class="chatbot-container">
            <div id="chatbox" class="myu-chatbox">
              <div class="placeholder-content">
                <i class="fas fa-robot"></i>
                <h4>Education Coach Chatbot</h4>
                <p>Ask anything about skill development, reflection, or planning!</p>
              </div>
              <div id="chat-messages" class="myu-chat-messages"></div>
              <form id="chat-form" class="myu-chat-form">
                <input id="chat-input" type="text" placeholder="Ask your question..." required />
                <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i> Send</button>
              </form>
              <div id="chat-error" class="myu-chat-error"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Learning Areas Section -->
    <section class="learning-areas-section">
      <div class="container">
        <div class="learning-content">
          <h3>üéØ Key Learning Areas</h3>
          <div class="learning-grid">
            <div class="learning-card"><i class="fas fa-comments"></i><h4>Communication Skills</h4><p>Improve your verbal, written, and interpersonal communication</p></div>
            <div class="learning-card"><i class="fas fa-users-cog"></i><h4>Leadership & Teamwork</h4><p>Build leadership and collaboration skills</p></div>
            <div class="learning-card"><i class="fas fa-lightbulb"></i><h4>Problem Solving</h4><p>Boost critical thinking and creativity</p></div>
            <div class="learning-card"><i class="fas fa-heart"></i><h4>Emotional Intelligence</h4><p>Practice empathy, awareness, and self-management</p></div>
            <div class="learning-card"><i class="fas fa-cogs"></i><h4>Technical Skills</h4><p>Learn tools, tech, and platforms relevant to your goals</p></div>
            <div class="learning-card"><i class="fas fa-globe"></i><h4>Cultural Awareness</h4><p>Appreciate diversity and cross-cultural communication</p></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="footer" role="contentinfo">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h3>DYL Volunteering Assistant</h3>
          <p>Empowering Republic Polytechnic students through meaningful volunteering experiences.</p>
        </div>
        <div class="footer-section">
          <h3>Quick Links</h3>
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="elyiana.html">Activity Planner</a></li>
            <li><a href="myu.html">Education Coach</a></li>
            <li><a href="https://www.rp.edu.sg" target="_blank">RP Website</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h3>Connect With Us</h3>
          <div class="social-links">
            <a href="https://www.facebook.com/republicpolytechnic" target="_blank"><i class="fab fa-facebook"></i></a>
            <a href="https://www.instagram.com/republicpoly" target="_blank"><i class="fab fa-instagram"></i></a>
            <a href="https://www.linkedin.com/school/republic-polytechnic" target="_blank"><i class="fab fa-linkedin"></i></a>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 Republic Polytechnic. All rights reserved. | Designed with ‚ù§Ô∏è for RP students</p>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="js/app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    const chatHistory = [];

    function renderMarkdown(text) {
      if (window.marked) {
        marked.setOptions({ gfm: true, breaks: true });
        return marked.parse(text);
      }
      return text.replace(/\n/g, "<br>");
    }

    function appendMessage(role, content) {
      const messages = document.getElementById("chat-messages");
      const msgDiv = document.createElement("div");
      msgDiv.innerHTML = `<strong>${role}:</strong><br>${renderMarkdown(content)}`;
      messages.appendChild(msgDiv);
      messages.scrollTop = messages.scrollHeight;
    }

    async function query(history) {
      try {
        // Send only the latest user message to Flowise
        const latestMessage = history[history.length - 1];
        const response = await fetch("https://myuth-flowise.hf.space/api/v1/prediction/7cab6fc9-44b7-4076-bbf3-d72a3a5a4864", {
          method: "POST",
          headers: { 
            "Content-Type": "application/json",
            "Accept": "application/json"
          },
          body: JSON.stringify({ 
            question: latestMessage.content,
            history: history.slice(0, -1).map(m => `${m.role}: ${m.content}`).join("\n")
          })
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        console.log('Flowise Response:', data); // Debug log
        return data;
      } catch (error) {
        console.error('Flowise API Error:', error);
        throw error;
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("chat-form");
      const input = document.getElementById("chat-input");
      const errorDiv = document.getElementById("chat-error");

      // Test Flowise connection on page load
      async function testFlowiseConnection() {
        try {
          console.log('Testing Flowise connection...');
          const response = await fetch("https://myuth-flowise.hf.space/api/v1/prediction/7cab6fc9-44b7-4076-bbf3-d72a3a5a4864", {
            method: "POST",
            headers: { 
              "Content-Type": "application/json",
              "Accept": "application/json"
            },
            body: JSON.stringify({ 
              question: "Hello, are you working?",
              history: ""
            })
          });
          
          if (response.ok) {
            console.log('‚úÖ Flowise connection successful');
            appendMessage("Myu", "Hello! I'm Myu, your Education Coach. I'm ready to help you with your learning journey. What would you like to know about skill development or volunteering?");
          } else {
            console.warn('‚ö†Ô∏è Flowise connection issue:', response.status);
          }
        } catch (error) {
          console.error('‚ùå Flowise connection failed:', error);
          errorDiv.textContent = "Connection issue detected. The chatbot may not respond properly.";
        }
      }

      // Test connection
      testFlowiseConnection();

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const userMsg = input.value.trim();
        if (!userMsg) return;

        chatHistory.push({ role: "You", content: userMsg });
        appendMessage("You", userMsg);
        input.value = "";
        errorDiv.textContent = "";

        // Show typing indicator
        appendMessage("Myu", "*typing...*");

        try {
          console.log('Sending message to Flowise:', userMsg); // Debug log
          const res = await query(chatHistory);
          
          // Handle different possible response formats from Flowise
          let botReply;
          if (res.text) {
            botReply = res.text;
          } else if (res.answer) {
            botReply = res.answer;
          } else if (res.response) {
            botReply = res.response;
          } else if (typeof res === 'string') {
            botReply = res;
          } else {
            console.log('Unexpected response format:', res);
            botReply = "I received your message but couldn't process the response properly. Please try again.";
          }

          chatHistory.push({ role: "Myu", content: botReply });

          // Remove typing indicator and show response
          const messages = document.getElementById("chat-messages");
          messages.lastChild.remove(); // remove typing
          appendMessage("Myu", botReply);
          
        } catch (err) {
          console.error('Chat error:', err);
          const messages = document.getElementById("chat-messages");
          messages.lastChild.remove(); // remove typing
          
          let errorMessage = "I'm having trouble connecting right now. ";
          if (err.message.includes('404')) {
            errorMessage += "The chatbot service seems to be unavailable.";
          } else if (err.message.includes('500')) {
            errorMessage += "There's a server issue. Please try again in a moment.";
          } else if (err.message.includes('NetworkError') || err.message.includes('Failed to fetch')) {
            errorMessage += "Please check your internet connection.";
          } else {
            errorMessage += "Please try again.";
          }
          
          errorDiv.textContent = errorMessage;
          appendMessage("Myu", "Sorry, I'm experiencing technical difficulties. Please try asking your question again.");
        }
      });
    });
  </script>
</body>
</html>
